# TDR200

The TDR200 instruction is used to measure one or more time domain reflectivity (TDR) probes attached to a TDR200 device.

## Syntax

TDR200(Dest,SDMAddress,Option,Mux/ProbeSelect,WaveAvg,Vp,Points,CableLength,WindowLength,ProbeLength,ProbeOffset,Mult, Offset,NoiseRejectionFreq,TDRFilterLevel,TDRLaa)

The following program uses the TDR200 instruction to measure La/L for a probe attached to the TDR200. The multiplier and offset convert the La/L value to water content using the Ledieu linear calibration function.

```
'Declare Variables
Public H2OContent

DataTable (TDR,1,-1)
DataInterval (0,5,Min,10)
Average (1,H2OContent,FP2,0)
EndTable

BeginProg
Scan (5,Sec,3,0)
'Measure TDR probe; convert to water content
TDR200(H2OContent,0,0,0001,4,1.0,251,5.75,5,.3,0.085,0.1138,-0.1758,0,0,0)
CallTable TDR
NextScan
EndProg
```

## Remarks

This instruction can be used to measure one TDR probe connected to the TDR200 directly or multiple TDR probes connected to one or more SDMX50 multiplexers.

## Parameters

# Dest

A variable or variable array in which to store the results of the measurement. The variable must be dimensioned to accommodate all of the values returned by the instruction, which is determined by the Option parameter.

Type: Variable or Variable Array

# SDMAddress (Address of Device)

Defines the address of the device with which to communicate. ValidSDM

**Note:** Synchronous Device for Measurement. A processor-based peripheral device or sensor that communicates with the datalogger via hardwire over a short distance using a protocol proprietary to Campbell Scientific.

addresses are 0 through 14. Address 15 is reserved for the SDMTrigger instruction.

Some SDM instructions support repetitions. If a Reps parameter is present and it is greater than 1, the data logger will increment the SDM address used in the instruction for each subsequent device with which it communicates.

# Option

Determines the output of the instruction.

| Code | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0    | Measure La/L (ratio of apparent to physical probe rod length)                                                                                                                                                                                                                                                                                                                                                                                                           |
| 1    | Collect Waveform values - Outputs reflection waveform values as an array of floating point numbers with a range of -1 to 1. The waveform values are prefaced by a header containing values of key parameters for this instruction including averaging, propagation velocity, points, cable length, window length, probe length, probe offset, multiplier, and offset. For the TDR200, noise rejection frequency, filter level, and Laa are also included in the header. |
| 2    | Collect Waveform plus First Derivative - Returns (2\* n-5)+9 values where n is the number of waveform reflection values specified by the Points parameter.                                                                                                                                                                                                                                                                                                              |
| 3    | Measure Electrical Conductivity - Outputs a value that when multiplied by the Multiplier parameter determines soil bulk electrical conductivity in S/m.                                                                                                                                                                                                                                                                                                                 |

Type: Constant

# Mux/ProbeSelect

Used to define the setup of any multiplexers and attached probes in the system. The addressing scheme used is ABCR, where A = level 1 multiplexer channel, B = level 2 multiplexer channel, C = level 3 multiplexer channel, and R = the number of consecutive probes to be read, starting with the channel specified by the ABC value (maximum of 8). 0 is entered for any level not used.

Type: Constant

# WaveAvg

Used to define the number of waveform reflections averaged by the TDR100/200 to give a single result. A waveform averaging value of 4 provides good signal-to-noise ratio under typical applications. Under high noise conditions averaging can be increased. The maximum averaging possible is 128.

Type: Constant or Variable

# Vp

Allows you to enter the propagation velocity of a cable when using the instruction to test for cable lengths or faults. Vp adjustment is not necessary for soil water content or electrical conductivity measurement and should be set to 1.0 for output Option 1, 2, or 3.

Type: Constant or Variable

# Points

Used to define the number of values in the displayed or collected waveform (20 to 2048 for the TDR100; 20 to 10,112 for the TDR200). An entry of 251 is recommended for soil water measurements. The waveform consists of the number of Points equally spaced over the WindowLength.

Type: Constant

# CableLength

Specifies the cable length, in meters, of the TDR probes. If a 0 is entered for the Option parameter, cable length is used by the analysis algorithm to begin searching for the TDR probe. If a 1 or 2 is entered for the Option parameter, cable length is the distance to the start of the collected waveform.

The value used for CableLength is best determined using PCTDR with the Vp = 1.0. Adjust the CableLength and WindowLength values in PCTDR until the probe reflection can be viewed. Subtract about 0.5 meters from the distance associated with the beginning of the probe reflection.

Note that if CableLength is a scalar the specified CableLength applies to all probes read by this instruction; therefore, all probes must have the same cable lengths. However, CableLength can be a variable array loaded with the cable length values to use for each probe; e.g., CableLength(1) is used for the first probe, CableLength(2) is use for the second probe, etc. In this instance, the CableLength array should be loaded with values prior to the start of the scan.

Type: Constant or Variable Array

# WindowLength

Specifies the length, in meters, of the waveform to collect or analyze. The waveform begins at the CableLength and ends at the CableLength + WindowLength. This is an apparent length because the value set for Vp may not be the actual propagation velocity. For water content measurements, the WindowLength must be large enough to contain the entire probe reflection for probes with 20 to 30 cm rods. A Vp = 1 and Window length = 5 is recommended.

Type: Constant or Variable

# ProbeLength

Specifies the length, in meters, of the probe rods that are exposed to the medium being measured. The value of this parameter only has an affect when Option 0, La/L, is used for the measurement.

Type: Constant or Variable

# ProbeOffset

An apparent length value used to correct for the portion of the probe rods that may be encapsulated in epoxy and not surrounded by soil or other medium being measured. This value is supplied by Campbell Scientific for the probes we manufacture. The value of this parameter only has an affect when Option 0, La/L, is used for the measurement.

Type: Constant or Variable

# Mult, Offset (Multiplier and Offset)

Factors by which to scale the raw results of the measurement. Typically used to convert the raw measurement to engineering units or to units other than which is output. For example, the TCDiff instruction measures a thermocouple and outputs temperature in degrees C. A multiplier of 1.8 and an offset of 32 will convert the temperature to degrees F.

For temperature measurements, a multiplier (mult) of 1 and an offset of 0, would output in degrees Celsius. For analog measurements, a multiplier (mult) of 1 and an offset of 0, would output the measured voltage in millivolts divided by the excitation voltage in volts.

If Repetitions of greater than 1 are used for this instruction, Repetitions can also be used for the Multiplier and Offset.[SeeMultipliers, Offsets, and Disable Variables with Repetitionsfor more information.](../Info/multipliersoffsets.md)

Type: Constant, Variable, Array, or Expression

# NoiseRejectionFreq

The type of noise rejection to be applied to the measurement. Valid options are:

| Code | Description                                                                                                                                                                                                                       |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0    | No frequency rejection will be used in the measurement.                                                                                                                                                                           |
| 50   | The TDR will take 2 contiguous measurements that are exactly 10 ms out of phase in order to cancel 50 Hz noise. If the WaveAvg parameter is an odd number, the actual number of averages will be the next highest even integer.   |
| 60   | The TDR will take 2 contiguous measurements that are exactly 8.33 ms out of phase in order to cancel 60 Hz noise. If the WaveAvg parameter is an odd number, the actual number of averages will be the next highest even integer. |

Type: Constant

# TDRFilterLevel

The TDR200 can reduce noise of the TDR trace by applying a weighted moving average (arithmetic convolution) to the data points. This parameter is used to determine the number of neighboring values to include in the weighted average. Acceptable values are 0 (no filtering) to 10 (maximum filtering). As an example, choosing a Filter Level of 2 will use 5 measured values in calculating the final output value: 2 values prior to the point of interest, the actual measured point of interest, and the 2 values after that point. Each of those points is weighted with the closer points having more weight than those further away.

Type: Constant

# TDRLaa

Allows the user to select the desired algorithm that the TDR200 will use to determine the end of the probe (2nd reflection). The following algorithms are available:

| Code | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0    | Legacy Algorithm. This algorithm is similar to that used in the TDR100 and uses the 2nd derivative of the waveform to detect inflection points. This is a simple method that is consistent over varying soils and water contents. It will yield the same values as those given by the TDR100. This algorithm has difficulty in electrically noisy environments (nearby radios, motors, fluorescent and LED lighting) or when the length of probes are short.                                                                                      |
| 1    | Tangent Line Method. This algorithm uses the flatline method made popular in the WinTDR software package. This method works well without any predefined waveform attributes and has the advantage of being more resistant to noisy environments.                                                                                                                                                                                                                                                                                                  |
| 2    | Second-Order Bounded Mean Oscillation (BMO) Method. The second-order BMO method has been developed to aid in researchers using short probes with non-smooth lines (Wang et al., 2014). When this method is selected, PCTDR uses a combined approach of both tangent line and second-order BMO methods (Wang et al., 2016). This combined method uses the tangent line to narrow in on the region of the waveform where the second reflection appears and then uses the second-order BMO method to finalize the point representing the probe s end |

Type: Constant

Reference: Wang, Z., Y. Kojima, S. Lu, Y. Chen, R. Horton, and R.C. Schwartz. 2014. Time domain reflectometry waveform analysis with second order bounded mean oscillation. Soil Sci. Soc. Am. J. 78:1146 1152. doi:10.2136/sssaj2013.11.0497

Wang, Z., Y. Lu, Y. Kojima, S. Lu, M. Zhang, Y. Chen, R. Horton. 2016. Tangent Line/Second-Order Bounded Mean Oscillation Waveform Analysis for Short TDR Probe. Vadose Zone J. Vol. 15, Iss. 1. doi:10.2136/vzj2015.04.0054
